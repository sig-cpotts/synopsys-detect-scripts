buildscript {
    ext {
        springBootVersion = '2.0.3.RELEASE'
    }

    apply from: 'https://raw.githubusercontent.com/blackducksoftware/integration-resources/master/gradle_common/buildscript-repositories.gradle', to: buildscript
    apply from: 'https://raw.githubusercontent.com/blackducksoftware/integration-resources/master/gradle_common/buildscript-dependencies.gradle', to: buildscript

    dependencies {
        classpath 'com.blackducksoftware.integration:integration-rest:0.10.2'
        classpath 'org.codehaus.groovy:groovy-all:2.4.12'
        classpath 'org.junit.jupiter:junit-jupiter:5.4.2'
        classpath 'org.mockito:mockito-core:2.+'
    }
}

plugins {
    id 'com.github.johnrengelman.shadow' version '5.0.0'
}

version = '2.5.2-SNAPSHOT'

apply plugin: 'com.synopsys.integration.simple'

jar {
    manifest {
        attributes 'Main-Class': 'com.synopsys.integration.synopsys.detect.scripts.Application'
    }
}

shadowJar {
    getArchiveBaseName().set('synopsys-detect-scripts')
    classifier = null
}

jar.finalizedBy shadowJar

build.dependsOn.add("generateVersionFile")
build.dependsOn.add("generateScripts")
build.dependsOn.add("generateCert")

task generateVersionFile {
    final File versionFile = new File(project.projectDir, "src/main/resources/version.txt")
    versionFile.delete()
    versionFile << version
}

task generateScripts(type: JavaExec) {
    main = "-jar"
    args(jar.getArchiveFile().get().asFile, "scripts", "${project.buildDir}/libs/")
}

task generateCert(type: JavaExec) {
    main = "-jar"
    args(jar.getArchiveFile().get().asFile, "cert", "${project.buildDir}/libs/")
}

dependencies {
    implementation 'com.blackducksoftware.integration:common-gradle-plugin:0.0.+'
    implementation 'com.blackducksoftware.integration:blackduck-common:+'
    implementation 'org.freemarker:freemarker:2.3.26-incubating'

    runtimeClasspath 'com.blackducksoftware.integration:common-gradle-plugin:0.0.+'
    runtimeClasspath 'com.blackducksoftware.integration:blackduck-common:+'

    testImplementation 'org.junit.jupiter:junit-jupiter:5.4.2'
    testImplementation 'org.mockito:mockito-core:2.+'
}
